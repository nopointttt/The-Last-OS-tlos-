# Отчет по отладке коннективности Assembly (ASM)

## 0. Суть проблемы
Индикатор Assembly (ASM) в Shell оставался красным. Причинами были:
1.  **Ошибка маршрутизации wRPC**: Shell отправлял запросы Assembly на топик Spatial.
2.  **Ошибки сборки Shaper**: Актор Shaper блокировал общую сборку проекта.
3.  **Изоляция NATS**: `wash dev` запускал актора в «своем» NATS, а Shell искал его на порту 4222.
4.  **Ошибки WIT**: У Assembly отсутствовали зависимости WASI (logging), что мешало сборке с новым кодом.

---

## 1. Выполненные действия

### Shell (Lattice Bridge)
*   **Маршрутизация**: Исправлен `lattice_bridge.rs`. Теперь SPT и ASM имеют свои wRPC-клиенты и правильные префиксы NATS (`wasmcloud.rpc.default.{actor}`).
*   **Диагностика**: Добавлен инструмент **NATS Spy**. При старте Shell сканирует сеть 5 секунд и выводит список всех активных RPC-топиков.
*   **Оптимизация**: Реализованы параллельные Health Checks с таймаутом 2с, чтобы зависший актор не блокировал интерфейс.

### Актор Shaper
*   **API Update**: Код переведен на высокоуровневый `wasmcloud-component` (0.2.0). Исправлены сигнатуры трейтов и пути импорта WASI.

### Актор Assembly
*   **WIT Fix**: Скопированы зависимости из `shaper/wit/deps` в `assembly/wit/deps`.
*   **Logging**: В актор внедрено логирование (`wasi:logging`), позволяющее ему сообщать о своей активности в лог хоста.
*   **dev.ps1**: Создан скрипт запуска, который принудительно подключает актора к NATS на порту 4222 (`$env:WASH_NATS_ADDR`).

---

## 2. Текущее состояние
1.  **Сборка**: Все компоненты (`shell`, `shaper`, `assembly`) собираются успешно.
2.  **Инфраструктура**: 
    *   Рекомендуется запускать внешний `nats-server` на 4222.
    *   Актор запускается через `.\dev.ps1`.
3.  **Готовность**: Система готова к финальной проверке индикатора ASM.

---

## 3. Инструкция для возобновления
1.  Запустить `nats-server`.
2.  В `actors/assembly` запустить `.\dev.ps1`.
3.  В корне запустить `.\target\release\desk-shell.exe`.
4.  Проверить лог на наличие `[RPC] wasmcloud.rpc.default.assembly`.
