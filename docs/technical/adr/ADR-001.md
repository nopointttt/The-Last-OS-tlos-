# ADR-001: Выбор wasmCloud как основы распределенной архитектуры

*   **Статус**: Accepted
*   **Дата**: 2026-02-12
*   **Авторы**: @antigravity
*   **Связанные ADR**: —

## 1. Контекст и Проблема (Context)
Проект tLOS изначально разрабатывался как монолитное Rust-приложение с веб-интерфейсом. Однако визия "The Last OS" как суверенной, пространственной операционной системы требует:
1.  **Безопасности**: Изоляция логики приложений (актёров) от ОС хоста.
2.  **Децентрализации**: Возможность легкого перемещения логики между узлами сети (Lattice).
3.  **Универсальности**: Запуск одного и того же кода на Desktop, Mobile и Edge без перекомпиляции.
4.  **Горячей замены**: Обновление функционала без перезапуска всей системы.

## 2. Факторы Решения (Decision Drivers)
*   Поддержка стандарта **WASI Preview 2** (Component Model).
*   Наличие встроенной шины сообщений (**NATS/Lattice**).
*   Безопасный рантайм на базе **Wasmtime**.
*   Возможность интеграции кастомных провайдеров (для криптографии и отрисовки).

## 3. Рассматриваемые Варианты (Considered Options)
1.  **Собственный рантайм на Wasmtime**: Написание оркестратора с нуля.
2.  **Kubernetes + KubeEdge**: Использование стандартных облачных инструментов.
3.  **wasmCloud**: Готовая платформа для распределенных Wasm-компонентов.

## 4. Оценка Вариантов (Pros and Cons)

### Собственный рантайм на Wasmtime
*   **Плюсы**: Полный контроль над бинарным форматом и протоколами.
*   **Минусы**: Огромные затраты на реализацию сетевого слоя, горячей замены и безопасности. Изобретение велосипеда.

### Kubernetes + KubeEdge
*   **Плюсы**: Промышленный стандарт, огромная экосистема.
*   **Минусы**: Слишком тяжеловесно для десктопного/мобильного применения. Ориентировано на Docker, а не на легковесные Wasm-компоненты.

### wasmCloud
*   **Плюсы**: Нативная поддержка **Lattice** (NATS), идеальное соответствие модели "Актёр-Провайдер", поддержка WASI P2, активное комьюнити (Bytecode Alliance).
*   **Минусы**: Высокий порог вхождения (WIT, wRPC), на момент 2026 года тулчейн (`wash`) всё еще требует тонкой настройки.

## 5. Решение (Decision Outcome)
Выбранный вариант: **wasmCloud**.
Это решение позволяет нам сфокусироваться на бизнес-логике (пространственный индекс, криптография) вместо написания сетевой инфраструктуры. Модель Lattice идеально ложится в концепцию tLOS как "Spatial OS", где узлы динамически находят друг друга.

## 6. Последствия (Consequences)
*   **Положительные**: Мы получили готовую систему децентрализации и песочницу для кода.
*   **Отрицательные**: Необходимость поддерживать локальные WIT-зависимости и адаптировать Rust-код под строгие требования Component Model. Зависимость от стабильности `wash`.

---
*Документ следует расширенному формату MADR (Markdown Architectural Decision Records).*
