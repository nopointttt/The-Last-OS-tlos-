# Isolation Specs: The Sandbox Boundaries

Этот документ описывает технические спецификации изоляции в **The Last OS (tLOS)**. tLOS реализует иерархическую систему изоляции, гарантирующую безопасность даже при выполнении недоверенного AI-кода.

---

## 1. Software Fault Isolation (SFI) — Уровень Wasm
Основной уровень изоляции, реализуемый рантаймом (Wasmtime).
- **Linear Memory Bounds**: Каждый актёр ограничен своим сегментом памяти. Попытка доступа за предел (Out-of-bounds) вызывает мгновенный `Trap`.
- **Stack Protection**: Стек вызовов Wasm отделен от памяти данных и недоступен для актёра (защита от ROP-атак).
- **CFI (Control Flow Integrity)**: Все косвенные вызовы проверяются на соответствие типов (WIT-signatures).

---

## 2. Изоляция Ресурсов (Resource Constraints)
Для предотвращения атак типа "Noisy Neighbor":
- **Fuel Mechanism**: Ограничение количества инструкций процессора на один цикл выполнения.
- **Memory Guard Regions**: Использование 2ГБ защитных зон вокруг линейной памяти для предотвращения ошибок знакового расширения.
- **Pooling Allocator**: Использование пула заранее выделенной памяти для мгновенного запуска актёров без утечек данных между сессиями (через Zero-initialization).

---

## 3. Side-Channel Mitigations
Защита от атак по сторонним каналам (Spectre, Meltdown):
- **Constant-Time Wasm**: Криптографические примитивы используют расширения для гарантированного времени выполнения.
- **MPK (Memory Protection Keys)**: Аппаратная раскраска памяти на уровне CPU (x86_64) для изоляции памяти ядра от памяти пользователя без переключения контекста (Context Switch).
- **Spectre Hardening**: Маскирование индексов при доступе к таблицам функций и использование реполайнов (Retpolines).

---

## 4. Hardware-Assisted Isolation (Confidential Computing)
Для критических нод Lattice:
- **Intel TDX / AMD SEV-SNP**: Выполнение ядра tLOS внутри защищенного аппаратного анклава.
- **Remote Attestation**: Возможность для пользователя проверить, что его данные обрабатываются именно в доверенной копии ОС через аппаратную подпись процессора.

---
*Документ соответствует стандартам NIST IR 8505 и спецификациям Wasmtime 2026.*
